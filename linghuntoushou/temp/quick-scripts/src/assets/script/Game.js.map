{"version":3,"sources":["assets\\script\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport Ball from \"./Ball\";\r\nimport Basket from \"./Basket\";\r\nimport Clock, { CLOCK_UIMODE, IClockParam, IClockView } from \"./Clock\";\r\nimport CoinMgr from \"./CoinMgr\";\r\nimport Launch from \"./Launch\";\r\nimport Settle from \"./Settle\";\r\nimport SoundMgr from \"./SoundMgr\";\r\nimport EventMgr from \"./common/EventMgr\";\r\nimport { GEvent, Global, SoundPath } from \"./common/Global\";\r\nimport Module from \"./common/Module\";\r\nimport { NodeFactory } from \"./common/NodeFactory\";\r\nimport Utils from \"./common/Utils\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends Module {\r\n    @property(cc.Node)\r\n    ballNode: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    basketNode: cc.Node = null;\r\n\r\n    @property(cc.ProgressBar)\r\n    progress: cc.ProgressBar = null;\r\n\r\n    @property(cc.Label)\r\n    timeLabel: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    scoreLabel: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    effectLayer: cc.Node = null;\r\n\r\n    @property(cc.Prefab)\r\n    starPre: cc.Prefab = null;\r\n\r\n    @property(cc.Label)\r\n    starLabel: cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    addTimeBtn: cc.Button = null;\r\n\r\n    private ball: Ball = null;\r\n    private basket: Basket = null;\r\n    /**当前篮筐方向 左负右正 */\r\n    public basketDirection: number = 1;\r\n    /**是否结束 */\r\n    public isTimeEnd: boolean = false;\r\n    private clock: Clock = null;\r\n    private isGameOver: boolean = false;\r\n    private starFactory: NodeFactory = null;\r\n\r\n    private _score: number = 0;\r\n    private get score(): number {\r\n        return this._score;\r\n    }\r\n    private set score(v: number) {\r\n        this._score = v;\r\n        this.scoreLabel.string = v.toString();\r\n    }\r\n\r\n    protected onLoad(): void {\r\n        this.ball = this.ballNode.getComponent(Ball);\r\n        this.basket = this.basketNode.getComponent(Basket);\r\n        this.addEvents();\r\n        this.initClock();\r\n        this.updateStar(CoinMgr.ins.getCoin());\r\n        this.starFactory = new NodeFactory().init(this.starPre);\r\n        this.createStar();\r\n        this.initPickType();\r\n        Module.get(Settle).hide();\r\n        EventMgr.ins.on(GEvent.coinChanged, this.onCoinChanged, this);\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        EventMgr.ins.off(GEvent.coinChanged, this.onCoinChanged, this);\r\n    }\r\n\r\n    public show() {\r\n        this.node.active = true;\r\n        this.node.runAction(cc.fadeIn(1));\r\n        this.newGame();\r\n    }\r\n\r\n    public hide() {\r\n        this.node.runAction(cc.fadeOut(1));\r\n        setTimeout(() => {\r\n            this.node.active = false;\r\n        }, 1000);\r\n    }\r\n\r\n    private addEvents() {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.addTimeBtn.node.on(`click`, this.onAddTime, this);\r\n    }\r\n\r\n    private initClock() {\r\n        let param: IClockParam = {\r\n            totalTime: 5,\r\n            endCall: this.onTimeEnd.bind(this)\r\n        };\r\n\r\n        let uiParam: IClockView = {\r\n            viewMode: CLOCK_UIMODE.showRemain,\r\n            progress: this.progress,\r\n            timeLabel: this.timeLabel,\r\n        }\r\n        let clock = this.clock = new Clock();\r\n        clock.init(param).initView(uiParam);\r\n    }\r\n\r\n    private initPickType() {\r\n        let key = `shopProps`;\r\n        let localData = Global.ins.localData.getData(key);\r\n        let type = 1;\r\n        if (localData) {\r\n            type = localData.find(item => !item.isLock && item.isPick).type;\r\n        }\r\n        Global.ins.shopPickType = type;\r\n    }\r\n\r\n    public newGame() {\r\n        this.clock.reset();\r\n        this.basketDirection = -1;\r\n        this.basket.reset(this.basketDirection);\r\n        this.ball.reset();\r\n        this.isTimeEnd = false;\r\n        this.score = 0;\r\n        this.isGameOver = false;\r\n        this.addTimeBtn.interactable = false;\r\n    }\r\n\r\n    private onTouchEnd(e: cc.Event.EventTouch) {\r\n        if (this.isTimeEnd) return;\r\n        this.ball.jump();\r\n    }\r\n\r\n    private onAddTime() {\r\n        Module.get(SoundMgr).playBtnSound();\r\n        if (this.isTimeEnd) return;\r\n        let remainStar = CoinMgr.ins.getCoin();\r\n        if (remainStar < 10) return;\r\n        CoinMgr.ins.changeCoin(-10);\r\n        this.clock.reset().start();\r\n    }\r\n\r\n    /**达成目标 */\r\n    public onHitBasket() {\r\n        Module.get(SoundMgr).playEffect(SoundPath.fresh);\r\n        this.score++;\r\n        this.basketDirection *= -1;\r\n        this.basket.reset(this.basketDirection);\r\n        this.clock.reset().start();\r\n        this.isTimeEnd = false;\r\n        this.addTimeBtn.interactable = true;\r\n    }\r\n\r\n    private createStar() {\r\n        let star = this.starFactory.get();\r\n        star.parent = this.effectLayer;\r\n        let x = Utils.randomInt(-250, 250),\r\n            y = Utils.randomInt(-450, 450);\r\n        star.setPosition(x, y);\r\n    }\r\n\r\n    public onHitStar(starNode: cc.Node) {\r\n        Module.get(SoundMgr).playEffect(SoundPath.bubble);\r\n        this.starFactory.put(starNode);\r\n        CoinMgr.ins.changeCoin(1);\r\n        this.createStar();\r\n    }\r\n\r\n    private onCoinChanged() {\r\n        let num = CoinMgr.ins.getCoin();\r\n        this.updateStar(num);\r\n    }\r\n\r\n    private updateStar(num: number) {\r\n        this.starLabel.string = num.toString();\r\n    }\r\n\r\n    private onTimeEnd() {\r\n        this.isTimeEnd = true;\r\n        this.addTimeBtn.interactable = false;\r\n        if (this.ball.isOnGround) {\r\n            this.gameOver();\r\n        }\r\n    }\r\n\r\n    public gameOver() {\r\n        if (!this.isGameOver) {\r\n            this.isGameOver = true;\r\n            Module.get(Settle).show(this.score);\r\n        }\r\n    }\r\n\r\n}\r\n"]}