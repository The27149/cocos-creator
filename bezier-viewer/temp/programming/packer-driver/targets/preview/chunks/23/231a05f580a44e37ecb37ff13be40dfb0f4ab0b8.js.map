{"version":3,"sources":["file:///E:/work/git/majia/game_993000101/assets/scripts/Point.ts"],"names":["_decorator","Component","Node","NodeEventType","v2","UITransform","v3","Label","ccclass","property","Point","touchPos","touchPos_world","touchPos_node","paper","index","init","onLoad","addEvents","onDestroy","removeEvents","node","on","TOUCH_MOVE","onTouchMove","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","off","e","propagationStopped","updateCtrls","last","curCtrlPoint","hideCheckTag","showCheckTag","isFormat","touch","getUILocation","x","y","parent","getComponent","convertToNodeSpaceAR","Math","round","setPosition","reset","i","coordinate","string","checkTag","active","scaleSelf","v","scale"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Button, Touch, EventTouch, NodeEventType, Vec2, v2, UITransform, Vec3, v3, Label } from 'cc';\nimport { Paper } from './Paper';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Point')\nexport class Point extends Component {\n\n    @property(Label)\n    coordinate: Label = null;\n\n    @property(Node)\n    checkTag: Node = null;\n\n    /**触摸点的位置 */\n    private touchPos: Vec2 = v2();\n    private touchPos_world: Vec3 = v3();\n    private touchPos_node: Vec3 = v3();\n\n    /**保存对画布的引用 */\n    private paper: Paper = null;\n    /**控制点下标 */\n    public index: number = 0;\n\n    init(paper: Paper) {\n        this.paper = paper;\n    }\n\n    onLoad() {\n        this.addEvents();\n    }\n\n    onDestroy() {\n        this.removeEvents();\n    }\n\n\n    private addEvents() {\n        this.node.on(NodeEventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(NodeEventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(NodeEventType.TOUCH_END, this.onTouchEnd, this);\n    }\n\n    private removeEvents() {\n        this.node.off(NodeEventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.off(NodeEventType.TOUCH_START, this.onTouchStart, this);\n        this.node.off(NodeEventType.TOUCH_END, this.onTouchEnd, this);\n    }\n\n    private onTouchMove(e: EventTouch) {\n        e.propagationStopped = true;\n        this.updateCtrls(e);\n    }\n\n    private onTouchStart() {\n\n    }\n\n    private onTouchEnd(e: EventTouch) {\n        this.updateCtrls(e, true);\n\n        let last = this.paper.curCtrlPoint;\n        if (last) last.hideCheckTag();\n        this.paper.curCtrlPoint = this;\n        this.showCheckTag();\n    }\n\n    private updateCtrls(e: EventTouch, isFormat: boolean = false) {\n        e.touch.getUILocation(this.touchPos);\n        this.touchPos_world.x = this.touchPos.x;\n        this.touchPos_world.y = this.touchPos.y;\n        this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(this.touchPos_world, this.touchPos_node);\n        if (isFormat) {\n            this.touchPos_node.x = Math.round(this.touchPos_node.x)\n            this.touchPos_node.y = Math.round(this.touchPos_node.y)\n        }\n        this.node.setPosition(this.touchPos_node.x, this.touchPos_node.y);\n        this.paper.updateCtrls();\n    }\n\n    public reset(i: number, x: number, y: number) {\n        this.index = i;\n        this.node.setPosition(v3(x, y));\n        this.coordinate.string = `P${i}(x:${x}, y:${y})`;\n    }\n\n    public showCheckTag() {\n        this.checkTag.active = true;\n    }\n\n    public hideCheckTag() {\n        this.checkTag.active = false;\n    }\n\n    public scaleSelf(v: number) {\n        this.node.scale = v;\n    }\n}\n\n"]}