{"version":3,"sources":["file:///E:/personal/bezier-viewer/project/assets/scripts/Paper.ts"],"names":["_decorator","Component","Node","Prefab","Sprite","Color","UITransform","v3","v2","CCFloat","NodeFactory","ccclass","property","Paper","pointPool","pointNum","stageMultiList","onLoad","pointPre","init","randomDraw","stage","arr","i","push","random","draw","min","max","Math","ctrls","n","length","k","len","node","children","getNode","parent","lineContainer","getComponent","color","lineColor","ui","width","height","lineWidth","t","x","y","item","ctrl","j","comb","pow","setPosition","stageMulti","num","res"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, Vec2, Sprite, Color, ColorKey, color, UITransform, Vec3, v3, v2, CCFloat } from 'cc';\nimport NodeFactory from './NodeFactory';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Paper')\nexport class Paper extends Component {\n\n    @property(Prefab)\n    pointPre: Prefab = null;\n\n    @property(Color)\n    lineColor: Color = null;\n\n    @property(CCFloat)\n    lineWidth: number = 5;\n\n    @property(Node)\n    lineContainer: Node = null;\n\n    @property(Node)\n    ctrlContainer: Node = null;\n\n\n    private pointPool: NodeFactory = null;\n    private pointNum: number = 2000;\n\n    onLoad() {\n        this.pointPool = new NodeFactory(this.pointPre);\n        this.pointPool.init(this.pointNum);\n        this.randomDraw();\n    }\n\n    private randomDraw(stage: number = 4) {\n        let arr: Vec2[] = [];\n        for (let i = 0; i < stage + 1; i++) {\n            arr.push(v2(this.random(-960, 960), this.random(-540, 540)));\n        }\n        this.draw(arr);\n    }\n\n    private random(min: number, max: number): number {\n        return Math.random() * (max - min) + min;\n    }\n\n    private draw(ctrls: Vec2[]) {\n        let n = ctrls.length - 1;\n        //绘制控制点\n        for (let k = 0; k < n + 1; k++) {\n\n        }\n        //绘制生成的线\n        for (let i = 0, len = this.pointNum; i < len; i++) {\n            let node = this.node.children[i];\n            if (!node) {\n                node = this.pointPool.getNode();\n                node.parent = this.lineContainer;\n            }\n            node.getComponent(Sprite).color = this.lineColor;\n            let ui = node.getComponent(UITransform);\n            ui.width = ui.height = this.lineWidth;\n            let t = i / len, x = 0, y = 0;\n            let item: number, ctrl: Vec2;\n            for (let j = 0; j < n + 1; j++) {\n                item = this.comb(n, j) * Math.pow(1 - t, n - j) * Math.pow(t, j);\n                ctrl = ctrls[j];\n                x += ctrl.x * item;\n                y += ctrl.y * item;\n            }\n            node.setPosition(v3(x, y));\n        }\n    }\n\n    /**计算阶乘 */\n    private stageMultiList: number[] = [1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800];\n    private stageMulti(num: number): number {\n        let res = this.stageMultiList[num];\n        if (!res) {\n            res = num * this.stageMulti(num - 1);\n            this.stageMultiList[num] = res;\n        }\n        return res;\n    }\n\n    /** 计算组合数 */\n    private comb(n: number, i: number): number {\n        return this.stageMulti(n) / this.stageMulti(i) / this.stageMulti(n - i);\n    }\n}\n\n"]}