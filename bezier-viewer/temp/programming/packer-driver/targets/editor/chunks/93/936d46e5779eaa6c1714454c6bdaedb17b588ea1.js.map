{"version":3,"sources":["file:///E:/work/git/majia/game_993000101/assets/scripts/Paper.ts"],"names":["_decorator","Component","Node","Prefab","Sprite","Color","UITransform","v2","CCFloat","Graphics","Label","director","Canvas","NodeEventType","Button","NodeFactory","Point","ccclass","property","Paper","canvasNode","pointPool","ctrlPoints","curCtrlPoint","curLineWidth","stageMultiList","onLoad","getScene","getComponentInChildren","node","addEvents","lineWidth","pointPre","init","sampleNum","randomDraw","onDestroy","removeEvents","on","TOUCH_MOVE","onTouchMove","MOUSE_WHEEL","onMouseWheel","addCtrlPoint","EventType","CLICK","onAddCtrl","removeCtrlPoint","onRemoveCtrl","standardBtn","onStandard","scaleUp","onClickScaleUp","scaleDown","onClickScaleDown","helpBtn","onClickHelp","helpCloseBtn","onClosekHelp","off","e","delta","touch","getDelta","position","add3f","x","y","long","getScrollY","scalePaper","isUp","v","scale","vStr","toFixed","parseFloat","paperScale","string","setScale","draw","stage","i","Math","round","random","push","min","max","updateCtrls","length","ctrlContainer","children","child","point","drawCtrls","points","n","len","t","item","ctrl","j","comb","pow","drawLines","last","putNode","getNode","parent","setSiblingIndex","getComponent","color","YELLOW","ui","width","height","reset","scaleSelf","g","graphicsContainer","clear","moveTo","lineTo","stroke","stageMulti","num","res","idx","index","temp","splice","setPosition","first","clone","subtract","helpContent","active"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, Vec2, Sprite, Color, ColorKey, color, UITransform, Vec3, v3, v2, CCFloat, Graphics, Label, find, director, Canvas, NodeEventType, EventTouch, EventMouse, Button } from 'cc';\nimport NodeFactory from './NodeFactory';\nimport { Point } from './Point';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Paper')\nexport class Paper extends Component {\n\n    @property(Prefab)\n    pointPre: Prefab = null;\n\n    @property(Color)\n    lineColor: Color = null;\n\n    @property(CCFloat)\n    lineWidth: number = 10;\n\n    @property(CCFloat)\n    sampleNum: number = 1000;\n\n    @property(Node)\n    lineContainer: Node = null;\n\n    @property(Node)\n    ctrlContainer: Node = null;\n\n    @property(Node)\n    graphicsContainer: Node = null;\n\n    @property(Label)\n    paperScale: Label = null;\n\n    @property(Button)\n    addCtrlPoint: Button = null;\n\n    @property(Button)\n    removeCtrlPoint: Button = null;\n\n    @property(Button)\n    standardBtn: Button = null;\n\n    @property(Button)\n    scaleUp: Button = null;\n\n    @property(Button)\n    scaleDown: Button = null;\n\n    @property(Button)\n    helpBtn: Button = null;\n\n    @property(Button)\n    helpCloseBtn: Button = null;\n\n    @property(Node)\n    helpContent: Node = null;\n\n    private canvasNode: Node = null;\n    private pointPool: NodeFactory = null;\n    /**所有控制点坐标 */\n    private ctrlPoints: Vec2[] = [];\n\n    /**当前选中的控制点 */\n    public curCtrlPoint: Point = null;\n    private curLineWidth: number = 1;\n\n    onLoad() {\n        this.canvasNode = director.getScene().getComponentInChildren(Canvas).node;\n        this.addEvents();\n        this.curLineWidth = this.lineWidth;\n        this.pointPool = new NodeFactory(this.pointPre);\n        this.pointPool.init(this.sampleNum);\n        this.randomDraw(3);\n    }\n\n    onDestroy() {\n        this.removeEvents();\n    }\n\n    private addEvents() {\n        this.canvasNode.on(NodeEventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.canvasNode.on(NodeEventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        this.addCtrlPoint.node.on(Button.EventType.CLICK, this.onAddCtrl, this);\n        this.removeCtrlPoint.node.on(Button.EventType.CLICK, this.onRemoveCtrl, this);\n        this.standardBtn.node.on(Button.EventType.CLICK, this.onStandard, this);\n        this.scaleUp.node.on(Button.EventType.CLICK, this.onClickScaleUp, this);\n        this.scaleDown.node.on(Button.EventType.CLICK, this.onClickScaleDown, this);\n        this.helpBtn.node.on(Button.EventType.CLICK, this.onClickHelp, this);\n        this.helpCloseBtn.node.on(Button.EventType.CLICK, this.onClosekHelp, this);\n    }\n\n    private removeEvents() {\n        this.canvasNode.off(NodeEventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.canvasNode.off(NodeEventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        this.addCtrlPoint.node.off(Button.EventType.CLICK, this.onAddCtrl, this);\n        this.removeCtrlPoint.node.off(Button.EventType.CLICK, this.onRemoveCtrl, this);\n        this.standardBtn.node.off(Button.EventType.CLICK, this.onStandard, this);\n        this.scaleUp.node.off(Button.EventType.CLICK, this.onClickScaleUp, this);\n        this.scaleDown.node.off(Button.EventType.CLICK, this.onClickScaleDown, this);\n        this.helpBtn.node.off(Button.EventType.CLICK, this.onClickHelp, this);\n        this.helpCloseBtn.node.off(Button.EventType.CLICK, this.onClosekHelp, this);\n    }\n\n    private onTouchMove(e: EventTouch) {\n        let delta = e.touch.getDelta();\n        this.node.position = this.node.position.add3f(delta.x, delta.y, 0);\n    }\n\n    private onMouseWheel(e: EventMouse) {\n        // console.log('滚动：', e, e.getScrollX(), e.getScrollY());\n        let long = e.getScrollY();\n        //向上滚 放大\n        this.scalePaper(long > 0);\n    }\n\n    /**缩放纸面 */\n    private scalePaper(isUp: boolean) {\n        let v = this.node.scale.x * (isUp ? 1.1 : 0.9);\n        let vStr = v.toFixed(3);\n        v = parseFloat(vStr);\n        this.paperScale.string = vStr;\n        this.node.setScale(v, v);\n        this.curLineWidth = this.lineWidth * (1 / this.node.scale.x);\n        this.draw();\n    }\n\n    private randomDraw(stage: number = 3) {\n        for (let i = 0; i < stage + 1; i++) {\n            let x = Math.round(this.random(-960, 960));\n            let y = Math.round(this.random(-540, 540));\n            this.ctrlPoints.push(v2(x, y));\n        }\n        this.draw();\n    }\n\n    private random(min: number, max: number): number {\n        return Math.random() * (max - min) + min;\n    }\n\n    /**控制点更新后 重绘曲线 */\n    public updateCtrls() {\n        this.ctrlPoints.length = this.ctrlContainer.children.length;\n        for (let i = 0; i < this.ctrlPoints.length; i++) {\n            let child = this.ctrlContainer.children[i];\n            let point = this.ctrlPoints[i];\n            if (!point) point = v2();\n            point.x = child.position.x;\n            point.y = child.position.y;\n            this.ctrlPoints[i] = point;\n        }\n        this.draw();\n    }\n\n    public draw() {\n        this.drawCtrls();\n        let points = this.ctrlPoints;\n        //计算路径坐标\n        let n = points.length - 1;\n        for (let i = 0, len = this.sampleNum; i < len; i++) {\n            let t = i / len, x = 0, y = 0;\n            let item: number, ctrl: Vec2;\n            for (let j = 0; j < n + 1; j++) {\n                item = this.comb(n, j) * Math.pow(1 - t, n - j) * Math.pow(t, j);\n                ctrl = points[j];\n                x += ctrl.x * item;\n                y += ctrl.y * item;\n            }\n            // this.line1(x, y, i);\n            this.drawLines(x, y, i);\n        }\n    }\n\n\n    // /**方式1： 点累积成线 */\n    // private line1(x: number, y: number, i: number) {\n    //     this.lineContainer.children.forEach(child => { this.pointPool.putNode(child) });\n    //     let node = this.lineContainer.children[i];\n    //     if (!node) {\n    //         node = this.pointPool.getNode();\n    //         node.parent = this.lineContainer;\n    //     }\n    //     node.getComponent(Sprite).color = this.lineColor;\n    //     let ui = node.getComponent(UITransform);\n    //     ui.width = ui.height = this.lineWidth;\n    //     node.setPosition(v3(x, y));\n    // }\n\n    /**绘制控制点*/\n    private drawCtrls() {\n        let children = this.ctrlContainer.children;\n        let points = this.ctrlPoints;\n        //如果有多余的点 先回收\n        while (children.length > points.length) {\n            let last = children[children.length - 1];\n            this.pointPool.putNode(last);\n        }\n        for (let i = 0; i < points.length; i++) {\n            let child = children[i];\n            if (!child) {\n                child = this.pointPool.getNode();\n                child.parent = this.ctrlContainer;\n                child.setSiblingIndex(i);\n                child.getComponent(Sprite).color = Color.YELLOW;\n                child.getComponent(Point).init(this);\n                let ui = child.getComponent(UITransform);\n                ui.width = ui.height = this.lineWidth * 5;\n            }\n            let x = points[i].x, y = points[i].y;\n            let point = child.getComponent(Point);\n            point.reset(i, x, y);\n            point.scaleSelf((1 / this.node.scale.x));\n        }\n    }\n\n    /**方式2： canvas2d绘制 */\n    private drawLines(x: number, y: number, i: number) {\n        let g = this.graphicsContainer.getComponent(Graphics);\n        g.lineWidth = this.curLineWidth;\n        if (i === 0) {\n            g.clear();\n            g.moveTo(x, y);\n        } else g.lineTo(x, y);\n        if (i === this.sampleNum - 1) g.stroke();\n    }\n\n    // private ctrls2() {\n    //     let g = this.graphicsContainer.getComponent(Graphics);\n    //     let ctrls = this.ctrlPoints;\n    //     for (let k = 0; k < ctrls.length; k++) {\n    //         g.circle(ctrls[k].x, ctrls[k].y, this.lineWidth * 1.5);\n    //         g.fillColor = Color.YELLOW;\n    //         g.fill();\n\n    //     }\n    // }\n\n    /**计算阶乘 */\n    private stageMultiList: number[] = [1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800];\n    private stageMulti(num: number): number {\n        let res = this.stageMultiList[num];\n        if (!res) {\n            res = num * this.stageMulti(num - 1);\n            this.stageMultiList[num] = res;\n        }\n        return res;\n    }\n\n    /** 计算组合数 */\n    private comb(n: number, i: number): number {\n        return this.stageMulti(n) / this.stageMulti(i) / this.stageMulti(n - i);\n    }\n\n\n    /**增加控制点 */\n    private onAddCtrl() {\n        if (!this.curCtrlPoint) return;\n        let idx = this.curCtrlPoint.index;\n        let temp = this.ctrlPoints.splice(idx + 1);\n        let x = Math.round(this.random(-960, 960)),\n            y = Math.round(this.random(-540, 540));\n        this.ctrlPoints.push(v2(x, y));\n        this.ctrlPoints.push(...temp);\n        this.draw();\n    }\n\n    /**减少控制点 */\n    private onRemoveCtrl() {\n        if (!this.curCtrlPoint) return;\n        if (this.ctrlPoints.length < 2) return;\n        let idx = this.curCtrlPoint.index;\n        this.ctrlPoints.splice(idx, 1);\n        this.draw();\n    }\n\n    /**标准化曲线 起点设置在（0, 0） */\n    private onStandard() {\n        this.node.setPosition(0, 0);\n        let first: Vec2 = this.ctrlPoints[0].clone();\n        if (!first) return;\n        for (let item of this.ctrlPoints) {\n            item.subtract(first);\n        }\n        this.draw();\n    }\n\n    private onClickScaleUp() {\n        this.scalePaper(true);\n    }\n\n    private onClickScaleDown() {\n        this.scalePaper(false);\n    }\n\n    private onClickHelp() {\n        this.helpContent.active = true;\n    }\n\n    private onClosekHelp() {\n        this.helpContent.active = false;\n    }\n}\n\n"]}